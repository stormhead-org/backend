syntax = "proto3";
package proto;
option go_package = "/proto";

import "entity.proto";

import "google/api/annotations.proto";

// ============================================================================
// Messages
// ============================================================================

enum ContentType {
  CONTENT_TYPE_UNSPECIFIED = 0;
  CONTENT_TYPE_COMMUNITIES = 1;
  CONTENT_TYPE_POSTS       = 2;
  CONTENT_TYPE_COMMENTS    = 3;
  CONTENT_TYPE_USERS       = 4;
  CONTENT_TYPE_ALL         = 5;
}

message SearchResult {
  ContentType content_type = 1;
  oneof result {
    Community community = 2;
    Post post           = 3;
    Comment comment     = 4;
    UserProfile user    = 5;
  }
  float relevance_score = 6;  // TODO:
}

// ============================================================================
// Search (FR-268-279) - Unified Search
// ============================================================================

message SearchRequest {
  ContentType content_type = 1;
  string query             = 2;  // min 3 chars
  string cursor            = 3;
  int32 limit              = 4;
}

message SearchResponse {
  repeated SearchResult results = 1;
  string next_cursor            = 2;
  bool has_more                 = 3;
}

// ============================================================================
// Service Definition
// ============================================================================

service SearchService {
  // Unified Search
  rpc Search(SearchRequest) returns (SearchResponse) {
    option (google.api.http) = {
      get: "/search"
    };
  }
}
